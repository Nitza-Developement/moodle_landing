---
import { Icon } from "astro-icon/components";
import Button from "./ui/Button.astro";
import ThemeToggle from "./ui/ThemeToggle.astro";
import LanguageSelector from "./ui/LanguageSelector.astro";
import { Image } from "astro:assets";
import logo from "../assets/logo.svg";

interface NavItem {
  name: string;
  href: string;
}

interface Props {
  logoName: string;
  nav: NavItem[];
  cta: {
    login: string;
    trial: string;
  };
  currentLang: string;
}

const { logoName, nav, cta, currentLang } = Astro.props;
---

<header
  class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-[10px] border-b border-border dark:bg-dark-bg-primary/95 dark:border-dark-border"
>
  <div class="container-custom flex items-center justify-between h-[72px]">
    <!-- Logo -->
    <a
      href="/"
      class="flex items-center gap-2.5 font-display font-bold text-2xl text-text-dark dark:text-dark-text-primary"
    >
      <div
        class="w-12 h-12 bg-dark-bg-primary/95 rounded-lg flex items-center justify-center text-white"
      >
        <Image src={logo} alt="Logo" />
      </div>
      <span>Metis<span class="text-primary">Host</span></span>
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden lg:flex items-center gap-2">
      {
        nav.map((item) => (
          <a
            href={item.href}
            class="px-4 py-2 text-[15px] font-medium text-text-muted rounded-md transition-all hover:text-text-dark hover:bg-bg-light dark:text-dark-text-muted dark:hover:text-dark-text-primary dark:hover:bg-dark-bg-tertiary"
          >
            {item.name}
          </a>
        ))
      }
    </nav>

    <!-- Desktop CTA -->
    <div class="hidden lg:flex items-center gap-3">
      <LanguageSelector currentLang={currentLang} />
      <ThemeToggle />
      <Button variant="ghost" href="/login">{cta.login}</Button>
      <Button variant="primary" href="#trial">{cta.trial}</Button>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      class="lg:hidden p-2 text-text-dark dark:text-dark-text-primary"
      aria-label="MenÃº"
    >
      <Icon name="lucide:menu" class="w-6 h-6 menu-open" />
      <Icon name="lucide:x" class="w-6 h-6 menu-close hidden" />
    </button>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="lg:hidden hidden bg-white border-t border-border dark:bg-dark-bg-primary dark:border-dark-border"
  >
    <nav class="container-custom py-4 flex flex-col gap-2">
      {
        nav.map((item) => (
          <a
            href={item.href}
            class="px-4 py-3 text-[15px] font-medium text-text-muted rounded-md transition-all hover:text-text-dark hover:bg-bg-light dark:text-dark-text-muted dark:hover:text-dark-text-primary dark:hover:bg-dark-bg-tertiary"
          >
            {item.name}
          </a>
        ))
      }

      <div
        class="flex items-center gap-3 px-4 py-3 border-t border-border mt-2 dark:border-dark-border"
      >
        <LanguageSelector currentLang={currentLang} />
        <ThemeToggle />
      </div>

      <div class="flex flex-col gap-3 px-4 pt-2">
        <Button variant="secondary" href="/login" class="justify-center"
          >{cta.login}</Button
        >
        <Button variant="primary" href="#trial" class="justify-center"
          >{cta.trial}</Button
        >
      </div>
    </nav>
  </div>
</header>

<script>
  const menuBtn = document.getElementById("mobile-menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuOpen = menuBtn?.querySelector(".menu-open");
  const menuClose = menuBtn?.querySelector(".menu-close");

  menuBtn?.addEventListener("click", () => {
    const isOpen = mobileMenu?.classList.contains("hidden");

    mobileMenu?.classList.toggle("hidden");
    menuOpen?.classList.toggle("hidden");
    menuClose?.classList.toggle("hidden");
  });

  // Close mobile menu when clicking a link
  mobileMenu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu?.classList.add("hidden");
      menuOpen?.classList.remove("hidden");
      menuClose?.classList.add("hidden");
    });
  });
</script>
