---
import { Icon } from 'astro-icon/components';
import { languages, defaultLang } from '@i18n/ui';

interface Props {
  currentLang: string;
}

const { currentLang } = Astro.props;
---

<div class="relative" id="language-selector">
  <button
    type="button"
    class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-text-muted hover:text-text-dark hover:bg-bg-light transition-colors dark:text-dark-text-muted dark:hover:text-dark-text-primary dark:hover:bg-dark-bg-tertiary"
    aria-label="Seleccionar idioma"
    id="language-toggle"
  >
    <Icon name="lucide:globe" class="w-4 h-4" />
    <span class="uppercase">{currentLang}</span>
    <Icon name="lucide:chevron-down" class="w-4 h-4" />
  </button>

  <div 
    id="language-dropdown"
    class="absolute top-full right-0 mt-2 py-2 bg-white border border-border rounded-lg shadow-lg min-w-[140px] hidden dark:bg-dark-bg-secondary dark:border-dark-border"
  >
    {Object.entries(languages).map(([code, name]) => (
      <a
        href={code === defaultLang ? '/' : `/${code}/`}
        class:list={[
          "flex items-center gap-2 px-4 py-2 text-sm hover:bg-bg-light transition-colors",
          "dark:hover:bg-dark-bg-tertiary",
          code === currentLang 
            ? "text-primary font-medium" 
            : "text-text-muted dark:text-dark-text-muted"
        ]}
      >
        {code === currentLang && <Icon name="lucide:check" class="w-4 h-4" />}
        <span class={code !== currentLang ? "ml-6" : ""}>{name}</span>
      </a>
    ))}
  </div>
</div>

<script>
  const toggle = document.getElementById('language-toggle');
  const dropdown = document.getElementById('language-dropdown');

  toggle?.addEventListener('click', () => {
    dropdown?.classList.toggle('hidden');
  });

  document.addEventListener('click', (e) => {
    const selector = document.getElementById('language-selector');
    if (!selector?.contains(e.target as Node)) {
      dropdown?.classList.add('hidden');
    }
  });
</script>
